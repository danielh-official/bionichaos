<!DOCTYPE html>
<html lang="en">

<head>
    <custom-head-attributes title="Real-Time Signal Amplification Microscope"
        description="A web application that uses Eulerian Video Magnification to visualize subtle changes in skin tone caused by blood flow, extracting a pulse signal from webcam video."
        keywords="Eulerian Video Magnification, remote photoplethysmography, rPPG, heart rate, pulse signal, webcam, educational tool, real-time signal amplification"
        image="https://bionichaos.com/FaceBloodWebCam/thumbnail.png" url="https://bionichaos.com/FaceBloodWebCam"></custom-head-attributes>
    <script src="../components/HeadAttributes.js"></script>

    <link rel="stylesheet" type="text/css" href="../styles.css">
    <link rel="stylesheet" type="text/css" href="face-blood-web-cam.css">

    <!-- --- MediaPipe Scripts --- -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
</head>

<body>
    <custom-header link="https://bionichaos.com/FaceBloodWebCam/"></custom-header>
    <script src="../components/Header.js"></script>

    <main>
        <h1>Real-Time Signal Amplification Microscope</h1>

        <div class="simulation-area">
            <div class="video-container">
                <span class="label" id="videoCanvasLabel">Live Video Feed (Dynamic Safe Zone)</span>
                <canvas id="displayCanvas" width="640" height="480"></canvas>
            </div>

            <div class="graph-container">
                <div class="graph-wrapper">
                    <span class="label">Waveform (Time Domain)</span>
                    <canvas id="timeDomainCanvas"></canvas>
                </div>
                <div class="graph-wrapper">
                    <span class="label">Spectrum (Frequency Domain)</span>
                    <canvas id="frequencyDomainCanvas"></canvas>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="alphaSlider">Amplification Factor: <span id="alphaValue">150</span></label>
                <input type="range" id="alphaSlider" min="0" max="300" value="150">
            </div>

            <div class="control-group">
                <label>Webcam Input Rate:</label>
                <div class="fps-display"><span id="fpsValue">52</span> FPS</div>
                <small style="color: #888; font-size: 0.75rem; margin-top: 4px;">Input is resampled to stable 30Hz for
                    math.</small>
            </div>

            <div class="control-group">
                <label for="lowCutoff">Low Cutoff (Hz) - High Pass</label>
                <input type="number" id="lowCutoff" value="0.7" step="0.1">
            </div>
            <div class="control-group">
                <label for="highCutoff">High Cutoff (Hz) - Low Pass</label>
                <input type="number" id="highCutoff" value="3.0" step="0.1">
            </div>
            <div class="control-group">
                <label style="color: var(--text-color); margin-bottom: 0.5rem;">Signal Source:</label>
                <label><input type="radio" name="roiMode" value="manual"> Manual ROI Box</label>
                <label><input type="radio" name="roiMode" value="auto" checked=""> Automated ROI (Face)</label>
            </div>
            <div class="control-group">
                <label style="color: var(--text-color); margin-bottom: 0.5rem;">Filters &amp; Visuals:</label>
                <label><input type="checkbox" id="enableHighPassToggle" checked=""> Enable High Pass (Drift
                    Removal)</label>
                <label><input type="checkbox" id="enableLowPassToggle" checked=""> Enable Low Pass (Noise
                    Removal)</label>
                <label><input type="checkbox" id="highlightSkinToggle" checked=""> Highlight Skin</label>
                <label><input type="checkbox" id="showAxesToggle" checked=""> Show Graph Axes</label>
                <label><input type="checkbox" id="showRawSignalToggle"> Show Raw Signal</label>
                <label><input type="checkbox" id="sonifyToggle"> Enable Sonification</label>
            </div>
            <div class="control-group">
                <button id="demoButton">Play Demo</button>
            </div>
        </div>

        <div class="text-content">
            <h3>About This Application</h3>
            <p>
                Welcome to the Real-Time Signal Amplification Microscope. This web application demonstrates the
                principle of <b>Eulerian Video Magnification</b> to reveal subtle, invisible changes in the world around
                us. Specifically, it is configured to detect minute variations in skin tone caused by the flow of blood,
                a technique known as <b>remote photoplethysmography (rPPG)</b>.
            </p>
            <p>
                By analyzing the video feed from your webcam, this tool extracts a pulse signal, amplifies it so it
                becomes visible as a green "throb" in the video, and analyzes it to estimate your heart rate in Beats
                Per Minute (BPM).
            </p>

            <h3>Hardware Compatibility: What if my camera isn't 30 FPS?</h3>
            <p>
                Typical webcams operate at 30 Frames Per Second (FPS), but many high-end cameras run at 60 FPS, and
                older cameras (or cameras in dark rooms) may drop to 15 FPS. This variation typically breaks
                mathematical analysis.
            </p>
            <p>
                To solve this, this application uses a <b>Signal Resampling Engine</b> with a virtual clock.
            </p>
            <ul>
                <li><b>If your camera is faster (e.g., 60 FPS):</b> The system takes the extra data frames and
                    averages/interpolates them down to a precise 30Hz timing. This actually improves accuracy by
                    reducing noise.</li>
                <li><b>If your camera is slower (e.g., 15 FPS):</b> The system uses <i>Linear Interpolation</i> to
                    mathematically "fill in the gaps" between the real frames, creating a smooth 30Hz signal that the
                    filters can process without errors.</li>
            </ul>
            <p>
                This ensures that the BPM calculation remains stable and accurate regardless of your specific hardware
                or lighting conditions.
            </p>

            <h3>How It Works: The Technology Behind the Signal</h3>
            <p>
                The process of extracting a heart rate from a video stream involves several key steps, all performed in
                real-time within your browser:
            </p>
            <ol>
                <li><b>Video Acquisition &amp; ROI Selection:</b> Your browser securely accesses your webcam. You can
                    then
                    choose a <b>Region of Interest (ROI)</b>, the specific area of the video to analyze.
                    <ul>
                        <li><b>Manual Mode:</b> You draw a box on the area you want to measure (e.g., your forehead or
                            cheek).</li>
                        <li><b>Automated Mode:</b> The application uses the MediaPipe Face Mesh model to automatically
                            detect your face and places an ROI on your forehead, an area with good blood perfusion.</li>
                    </ul>
                </li>
                <li><b>Signal Extraction (rPPG):</b> With every heartbeat, your heart pumps blood into your arteries.
                    This causes the volume of blood in the microvessels of your skin to increase slightly. Blood
                    hemoglobin absorbs green light more than red or blue light. This application averages the intensity
                    of the <b>green color channel</b> across all pixels in the ROI for each frame.</li>
                <li><b>Signal Processing (The Math):</b>
                    <ul>
                        <li><b>Detrending &amp; Resampling:</b> The raw signal is normalized and resampled to a strict
                            30Hz timeline to remove camera jitter.</li>
                        <li><b>High-Pass Filter (Drift Removal):</b> This removes slow-moving changes, such as shadows
                            moving across your face or the camera auto-exposure adjusting. Without this, the graph would
                            drift off the screen.</li>
                        <li><b>Low-Pass Filter (Noise Removal):</b> This removes fast, jittery noise that is too fast to
                            be a heartbeat.</li>
                        <li><b>Amplification:</b> The clean signal is multiplied by the <b>Amplification Factor</b> to
                            make it visible as a color change in the video.</li>
                    </ul>
                </li>
                <li><b>Analysis and Visualization:</b>
                    <ul>
                        <li><b>Time-Domain Graph:</b> Shows the wave of your pulse over time.</li>
                        <li><b>Frequency-Domain Graph (FFT):</b> Uses a Fast Fourier Transform to break the wave into
                            frequencies. The highest peak in the graph represents your heart rate.</li>
                    </ul>
                </li>
            </ol>

            <h3>Disclaimer</h3>
            <p>
                <b>This is a technology demonstration and an educational tool, NOT a medical device.</b> The BPM
                readings are estimations and can be affected by many factors, including lighting, movement, and camera
                quality. The data provided should not be used for medical diagnosis, monitoring, or any health-related
                decisions. Always consult a qualified healthcare professional for medical advice.
            </p>

            <h3>Future Directions</h3>
            <p>
                This application is a proof-of-concept. Future improvements could include:
            </p>
            <ul>
                <li><b>Multi-Person Tracking:</b> Analyzing multiple faces simultaneously.</li>
                <li><b>Motion Compensation:</b> Using optical flow to track skin pixels even when the user moves their
                    head significantly.</li>
                <li><b>Deep Learning:</b> Replacing the standard DSP filters with a trained neural network to extract
                    pulse signals even in total darkness (using IR cameras) or extreme motion.</li>
            </ul>
        </div>
    </main>

    <script src="face-blood-web-cam.js"></script>

    <script
        src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation_solution_simd_wasm_bin.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh_solution_packed_assets_loader.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh_solution_simd_wasm_bin.js"
        crossorigin="anonymous"></script>
</body>

</html>